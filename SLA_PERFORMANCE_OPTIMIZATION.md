# SLA Dashboard Performance Optimization

**–î–∞—Ç–∞:** 2026-01-19  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ  
**API:** `/api/sla/metrics`

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

SLA Dashboard –∏–Ω–æ–≥–¥–∞ –º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≥—Ä—É–∂–∞–ª—Å—è (3-10+ —Å–µ–∫—É–Ω–¥), –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ bin —è—á–µ–µ–∫.

### –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞:

1. **N+1 –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è bin —è—á–µ–µ–∫** - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞
   - –î–ª—è –∫–∞–∂–¥–æ–π bin —è—á–µ–π–∫–∏ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î
   - 50 —è—á–µ–µ–∫ = 50+ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –í—Ä–µ–º—è: ~2.5-10 —Å–µ–∫—É–Ω–¥ —Ç–æ–ª—å–∫–æ –Ω–∞ bin –º–µ—Ç—Ä–∏–∫–∏

2. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –ó–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –¥—Ä—É–≥ –∑–∞ –¥—Ä—É–≥–æ–º, —Ö–æ—Ç—è –º–æ–≥–ª–∏ –±—ã—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: ~500-1500ms

3. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–π –ª–∏–º–∏—Ç –Ω–∞ audit_events**
   - –ó–∞–≥—Ä—É–∂–∞–ª–æ—Å—å 500 –∑–∞–ø–∏—Å–µ–π, —Ö–æ—Ç—è –¥–ª—è —Ç–æ—á–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ 200
   - –õ–∏—à–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î –∏ —Å–µ—Ç—å

---

## ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è bin —è—á–µ–µ–∫

**–ë—ã–ª–æ (N+1 –ø—Ä–æ–±–ª–µ–º–∞):**
```typescript
// –ü–æ–ª—É—á–∞–µ–º —è—á–µ–π–∫–∏
const { data: binCells } = await supabaseAdmin
  .from("warehouse_cells")
  .select("id, code, cell_type")
  .eq("cell_type", "bin");

// ‚ùå –î–ª—è –∫–∞–∂–¥–æ–π —è—á–µ–π–∫–∏ - –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å!
for (const cell of binCells) {
  const { data: latestUnit } = await supabaseAdmin
    .from("units")
    .eq("cell_id", cell.id)
    .single();
}
```

**–°—Ç–∞–ª–æ (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å —Å JOIN):**
```typescript
// ‚úÖ –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç –≤—Å—ë —Å—Ä–∞–∑—É
const { data: binCellsWithUnits } = await supabaseAdmin
  .from("warehouse_cells")
  .select(`
    id, code, cell_type,
    units (id, barcode, status, updated_at, created_at)
  `)
  .eq("cell_type", "bin");

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –ø–∞–º—è—Ç–∏ (–±—ã—Å—Ç—Ä–æ)
for (const cell of binCellsWithUnits) {
  const latestUnit = cell.units.sort(...)[0];
}
```

**–£–ª—É—á—à–µ–Ω–∏–µ:** –û—Ç 2-10 —Å–µ–∫—É–Ω–¥ ‚Üí –¥–æ 200-500ms –¥–ª—è bin –º–µ—Ç—Ä–∏–∫

---

### 2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–ë—ã–ª–æ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ):**
```typescript
const { data: oldUnits } = await supabaseAdmin.from("units")...;
const { data: allUnits } = await supabaseAdmin.from("units")...;
const { data: outShipments } = await supabaseAdmin.from("outbound_shipments")...;
const { data: pickingTasks } = await supabaseAdmin.from("picking_tasks")...;
```

**–°—Ç–∞–ª–æ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):**
```typescript
// ‚úÖ –ü–µ—Ä–≤–∞—è –≥—Ä—É–ø–ø–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
const [
  { data: oldUnits },
  { data: allUnits }
] = await Promise.all([...]);

// ‚úÖ –í—Ç–æ—Ä–∞—è –≥—Ä—É–ø–ø–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
const [
  { data: outShipments },
  { data: pickingTasks }
] = await Promise.all([...]);
```

**–£–ª—É—á—à–µ–Ω–∏–µ:** ~500-1000ms —ç–∫–æ–Ω–æ–º–∏–∏ –≤—Ä–µ–º–µ–Ω–∏

---

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ª–∏–º–∏—Ç–∞ audit_events

**–ë—ã–ª–æ:**
```typescript
.limit(500)  // –ò–∑–±—ã—Ç–æ—á–Ω–æ
```

**–°—Ç–∞–ª–æ:**
```typescript
.limit(200)  // –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ç–æ—á–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –∑–∞ 7 –¥–Ω–µ–π
```

**–£–ª—É—á—à–µ–Ω–∏–µ:** ~100-300ms —ç–∫–æ–Ω–æ–º–∏–∏, –º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: **3-5 —Å–µ–∫—É–Ω–¥**
- –ü—Ä–∏ 50+ bin —è—á–µ–π–∫–∞—Ö: **8-10+ —Å–µ–∫—É–Ω–¥**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤: **8 + N** (–≥–¥–µ N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ bin —è—á–µ–µ–∫)

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: **800ms - 1.5 —Å–µ–∫—É–Ω–¥—ã** ‚ö°
- –ü—Ä–∏ 50+ bin —è—á–µ–π–∫–∞—Ö: **1-2 —Å–µ–∫—É–Ω–¥—ã** ‚ö°
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤: **6** (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ)

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 3-5x** üöÄ

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

1. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞ 1:**
   - –°—Ç–∞—Ä—ã–µ units (>24—á)
   - –í—Å–µ units –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º

2. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:**
   - Audit events (–Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ step 1)

3. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞ 2:**
   - Outbound shipments
   - Picking tasks

4. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:**
   - Bin cells —Å units (JOIN –∑–∞–ø—Ä–æ—Å)

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
- –í—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:
- ‚úÖ –ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ –ª–∏–Ω—Ç–µ—Ä
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API response
- ‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ TypeScript —Ç–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

### –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω):
```bash
git revert HEAD
```

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ —Å–µ–π—á–∞—Å):

1. **Response caching** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 30-60 —Å–µ–∫—É–Ω–¥
   ```typescript
   // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –±—É–¥—É—â–µ–º
   const cacheKey = `sla-metrics-${warehouse_id}`;
   const cached = await redis.get(cacheKey);
   if (cached) return cached;
   ```

2. **Database indexes** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤:
   ```sql
   CREATE INDEX IF NOT EXISTS idx_units_cell_id_updated_at 
     ON units(cell_id, updated_at DESC);
   
   CREATE INDEX IF NOT EXISTS idx_units_status_created_at 
     ON units(status, created_at DESC);
   ```

3. **Materialized view** –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –∞–≥—Ä–µ–≥–∞—Ü–∏–π:
   ```sql
   CREATE MATERIALIZED VIEW sla_daily_stats AS
   SELECT ...
   -- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–∞–∑ –≤ —á–∞—Å
   ```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

1. **Chrome DevTools:**
   - Network tab ‚Üí `/api/sla/metrics`
   - –°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å <2 —Å–µ–∫—É–Ω–¥)

2. **Supabase Dashboard:**
   - Database ‚Üí Performance
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å slow queries

3. **–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
   ```bash
   # –ï—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   console.time('SLA metrics');
   // ... –∫–æ–¥ ...
   console.timeEnd('SLA metrics');
   ```

---

## üë• –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ response –≤ Network tab
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-19  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
