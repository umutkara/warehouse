# –ú–∏–≥—Ä–∞—Ü–∏—è: –ú–∞—Å—Å–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è (Multi-Unit Tasks)

## –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ò–∑–º–µ–Ω–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `picking_tasks` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–∞—Å—Å–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π:
- **–ë—ã–ª–æ:** –û–¥–Ω–æ –∑–∞–¥–∞–Ω–∏–µ = –æ–¥–∏–Ω –∑–∞–∫–∞–∑
- **–°—Ç–∞–ª–æ:** –û–¥–Ω–æ –∑–∞–¥–∞–Ω–∏–µ = –æ–¥–Ω–∞ picking —è—á–µ–π–∫–∞ + –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞–Ω–∏–π –ø–æ picking —è—á–µ–π–∫–∞–º
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Å–æ–∑–¥–∞—Ç–µ–ª—è –∑–∞–¥–∞–Ω–∏—è
- ‚úÖ –ú–∞—Å—Å–æ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –≤ –¢–°–î (–∫–∞–∫ –≤ —Ä–µ–∂–∏–º–µ "–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ")
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –∑–∞–¥–∞–Ω–∏—è–º–∏
- ‚úÖ SLA –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç A: –ü–µ—Ä–≤–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (–º–∏–≥—Ä–∞—Ü–∏—è –µ—â—ë –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å)

#### 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Supabase —á–µ—Ä–µ–∑ SQL Editor

```bash
# –ò–ª–∏ —á–µ—Ä–µ–∑ psql
psql "postgresql://postgres:[PASSWORD]@[HOST]:5432/postgres"
```

#### 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
cat migrations/supabase_migration_picking_tasks_multi_unit.sql
```

#### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
# Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
npm run dev
```

---

### –í–∞—Ä–∏–∞–Ω—Ç B: –ú–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, –Ω–æ –∑–∞–¥–∞–Ω–∏—è –≤—Å—ë –µ—â—ë –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ—à—Ç—É—á–Ω–æ

–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –±—ã–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, –Ω–æ —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞–Ω–∏—è –Ω–µ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–ª–∏—Å—å, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

#### 1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏

```bash
# –í Supabase SQL Editor —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
cat FIX_GROUP_OLD_TASKS.sql
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- ‚úÖ –ù–∞–π–¥—ë—Ç –≤—Å–µ —Å—Ç–∞—Ä—ã–µ open/in_progress –∑–∞–¥–∞–Ω–∏—è —Å unit_id
- ‚úÖ –°–≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∏—Ö –ø–æ picking —è—á–µ–π–∫–∞–º
- ‚úÖ –û—Ç–º–µ–Ω–∏—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã (–æ—Å—Ç–∞–≤–∏—Ç —Å–∞–º–æ–µ —Å—Ç–∞—Ä–æ–µ –∑–∞–¥–∞–Ω–∏–µ)
- ‚úÖ –û–±—ä–µ–¥–∏–Ω–∏—Ç –≤—Å–µ units –≤ –æ–¥–Ω–æ –∑–∞–¥–∞–Ω–∏–µ
- ‚úÖ –ü–æ–∫–∞–∂–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏

#### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
# Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
npm run dev
```

#### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –≤ –¢–°–î –û—Ç–≥—Ä—É–∑–∫–∞ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–∫–∞–∑–æ–≤.

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `picking_task_units` - —Å–≤—è–∑—å many-to-many –º–µ–∂–¥—É –∑–∞–¥–∞–Ω–∏—è–º–∏ –∏ –∑–∞–∫–∞–∑–∞–º–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ picking_tasks
- `unit_id` - —Ç–µ–ø–µ—Ä—å nullable (–¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π = null)
- `created_by_name` - –Ω–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –∏–º–µ–Ω–∏ —Å–æ–∑–¥–∞—Ç–µ–ª—è

### API –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π** (`/api/ops/picking-tasks/create`):
- –°–æ–∑–¥–∞–µ—Ç 1 –∑–∞–¥–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ N –∑–∞–¥–∞–Ω–∏–π
- –ó–∞–ø–æ–ª–Ω—è–µ—Ç `picking_task_units` –¥–ª—è —Å–≤—è–∑–∏ —Å units
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–º—è —Å–æ–∑–¥–∞—Ç–µ–ª—è

**–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π** (`/api/tsd/shipping-tasks/list`):
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `unitCount` –∏ –º–∞—Å—Å–∏–≤ `units[]`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `created_by_name`
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç units –ø–æ –∑–∞–¥–∞–Ω–∏—è–º

**–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π** (`/api/tsd/shipping-tasks/complete-batch`):
- –ù–æ–≤—ã–π endpoint –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –ª–∏ units –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∑–∞–¥–∞–Ω–∏–µ

**SLA API** (–æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏):
- `/api/stats/processing-metrics` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±–µ–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏
- `/api/stats/shipping-tasks-sla` - –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç unit_id

## –¢–°–î –û—Ç–≥—Ä—É–∑–∫–∞ - –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞

### –†–∞–Ω—å—à–µ:
1. –í—ã–±—Ä–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
2. –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å FROM (—Å—Ç—Ä–æ–≥–æ –∏–∑ –∑–∞–¥–∞–Ω–∏—è)
3. –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å UNIT (—Å—Ç—Ä–æ–≥–æ –∏–∑ –∑–∞–¥–∞–Ω–∏—è)
4. –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å TO (—Å—Ç—Ä–æ–≥–æ –∏–∑ –∑–∞–¥–∞–Ω–∏—è)

### –¢–µ–ø–µ—Ä—å:
1. –í—ã–±—Ä–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –∏ –∏–º—è —Å–æ–∑–¥–∞—Ç–µ–ª—è)
2. **–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å FROM —è—á–µ–π–∫—É** (storage/shipping)
   - ‚ö° **–ó–∞–¥–∞—á–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–µ—Ä–µ—Ç—Å—è –≤ —Ä–∞–±–æ—Ç—É** (status ‚Üí in_progress)
   - üîí **–ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
   - ‚úÖ **OPS –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ç—É –∂–µ picking —è—á–µ–π–∫—É** –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
3. –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã –∏–∑ –∑–∞–¥–∞–Ω–∏—è (–æ—Ç 1 –¥–æ N)
4. –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å TO —è—á–µ–π–∫—É (picking, —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∑–∞–¥–∞–Ω–∏–µ–º)
5. –í—Å–µ –∑–∞–∫–∞–∑—ã –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ü–æ—á–µ–º—É –∑–∞–¥–∞—á–∞ –±–µ—Ä–µ—Ç—Å—è –≤ —Ä–∞–±–æ—Ç—É –ø—Ä–∏ —Å–∫–∞–Ω–µ FROM?

**–ü—Ä–æ–±–ª–µ–º–∞:** OPS –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å 2 –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –æ–¥–Ω—É picking —è—á–µ–π–∫—É:
- –ó–∞–¥–∞—á–∞ 1: 5 –∑–∞–∫–∞–∑–æ–≤ ‚Üí PICK-01
- –ó–∞–¥–∞—á–∞ 2: 3 –∑–∞–∫–∞–∑–∞ ‚Üí PICK-01 (—Ç–∞ –∂–µ —è—á–µ–π–∫–∞!)

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–¥–∞—á–∞ –±–µ—Ä–µ—Ç—Å—è –≤ —Ä–∞–±–æ—Ç—É —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–∫–∞–Ω–µ FROM:
- ‚úÖ –°–∫–ª–∞–¥—á–∏–∫ 1 —Å–∫–∞–Ω–∏—Ä—É–µ—Ç FROM ‚Üí –ó–∞–¥–∞—á–∞ 1 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "in_progress"
- ‚úÖ –°–∫–ª–∞–¥—á–∏–∫ 2 –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ó–∞–¥–∞—á—É 2 (–ó–∞–¥–∞—á–∞ 1 –≤ —Ä–∞–±–æ—Ç–µ —É –¥—Ä—É–≥–æ–≥–æ)
- ‚úÖ OPS –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –Ω–∞ —Ç—É –∂–µ —è—á–µ–π–∫—É –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞–Ω–∏—è –≤–∏–¥–Ω—ã –≤ –¢–°–î
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –≤ OPS —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∑–∞–∫–∞–∑–∞–º–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –∏–º—è —Å–æ–∑–¥–∞—Ç–µ–ª—è
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ –≤ –¢–°–î —Å –º–∞—Å—Å–æ–≤—ã–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ SLA –º–µ—Ç—Ä–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

## –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)

```sql
-- –£–¥–∞–ª–∏—Ç—å –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É
DROP TABLE IF EXISTS public.picking_task_units;

-- –í–µ—Ä–Ω—É—Ç—å unit_id –∫–∞–∫ NOT NULL (–≤–Ω–∏–º–∞–Ω–∏–µ: –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –±—É–¥—É—Ç —Å–ª–æ–º–∞–Ω—ã)
ALTER TABLE public.picking_tasks 
  ALTER COLUMN unit_id SET NOT NULL;

-- –£–¥–∞–ª–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ
ALTER TABLE public.picking_tasks 
  DROP COLUMN IF EXISTS created_by_name;
```

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –ü–æ—Å–ª–µ –æ—Ç–∫–∞—Ç–∞ –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è (—Å unit_id = null) —Å—Ç–∞–Ω—É—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!
