# Unit Enhancements - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## üìã –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏ (units):
- **–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏** - –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ –∑–∞–∫–∞–∑–æ–≤
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è** - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, –ø–∞—Ä—Ç–Ω–µ—Ä, —Ü–µ–Ω–∞
- **–î–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è** - –∫—Ä–∞—Å–∏–≤–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–µ –ª–æ–≥–∏ –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `units`

```sql
ALTER TABLE public.units 
  ADD COLUMN product_name text,        -- –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
  ADD COLUMN partner_name text,        -- –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (–º–µ—Ä—á–∞)
  ADD COLUMN price numeric(10, 2),    -- –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞
  ADD COLUMN photos jsonb DEFAULT '[]'::jsonb,  -- –ú–∞—Å—Å–∏–≤ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
  ADD COLUMN meta jsonb DEFAULT '{}'::jsonb;    -- –î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```

### –§–æ—Ä–º–∞—Ç –ø–æ–ª—è `photos`

```json
[
  {
    "url": "https://...",
    "filename": "warehouse_id/unit_id/timestamp.jpg",
    "uploaded_at": "2026-01-18T10:00:00Z",
    "uploaded_by": "user-uuid",
    "uploaded_by_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"
  }
]
```

### –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `unit_moves`

```sql
ALTER TABLE public.unit_moves
  ADD COLUMN note text,              -- –û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
  ADD COLUMN meta jsonb DEFAULT '{}'::jsonb;  -- –î–æ–ø. –¥–∞–Ω–Ω—ã–µ (–∫—É—Ä—å–µ—Ä, –∑–∞–¥–∞—á–∞)
```

### RPC –§—É–Ω–∫—Ü–∏—è: `get_unit_history`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é unit –∏–∑ —Ç—Ä—ë—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
1. **unit_moves** - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–æ —Å–∫–ª–∞–¥—É
2. **audit_events** - —Å–æ–±—ã—Ç–∏—è (—Å–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —Ñ–æ—Ç–æ)
3. **outbound_shipments** - –æ—Ç–≥—Ä—É–∑–∫–∏ –≤ OUT –∏ –≤–æ–∑–≤—Ä–∞—Ç—ã

## üìÇ Supabase Storage

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Storage Bucket

**–í–∞–∂–Ω–æ!** –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å bucket –≤ Supabase:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
2. Storage ‚Üí Create bucket
3. **Name:** `unit-photos`
4. **Public bucket:** Yes (–¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–æ—Ç–æ)
5. **File size limit:** 5MB
6. **Allowed MIME types:** `image/jpeg, image/png, image/webp`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```
unit-photos/
  ‚îî‚îÄ‚îÄ {warehouse_id}/
      ‚îî‚îÄ‚îÄ {unit_id}/
          ‚îú‚îÄ‚îÄ 1737187200000.jpg
          ‚îú‚îÄ‚îÄ 1737187300000.png
          ‚îî‚îÄ‚îÄ ...
```

### RLS –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è Storage

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ –≤ —Å–≤–æ–π warehouse
CREATE POLICY "Users can upload to their warehouse"
ON storage.objects FOR INSERT
TO authenticated
WITH CHECK (
  bucket_id = 'unit-photos' AND
  (storage.foldername(name))[1] IN (
    SELECT warehouse_id::text FROM profiles WHERE id = auth.uid()
  )
);

-- –í—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å
CREATE POLICY "Authenticated users can read photos"
ON storage.objects FOR SELECT
TO authenticated
USING (bucket_id = 'unit-photos');

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å —Ñ–æ—Ç–æ –∏–∑ —Å–≤–æ–µ–≥–æ warehouse
CREATE POLICY "Users can delete from their warehouse"
ON storage.objects FOR DELETE
TO authenticated
USING (
  bucket_id = 'unit-photos' AND
  (storage.foldername(name))[1] IN (
    SELECT warehouse_id::text FROM profiles WHERE id = auth.uid()
  )
);
```

## üîå API Endpoints

### 1. GET `/api/units/[unitId]`
–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ unit

**Response:**
```json
{
  "ok": true,
  "unit": {
    "id": "...",
    "barcode": "123456",
    "status": "storage",
    "product_name": "iPhone 15 Pro",
    "partner_name": "Apple Store",
    "price": 99999.99,
    "photos": [...],
    "cell_id": "...",
    "created_at": "...",
    "updated_at": "..."
  }
}
```

### 2. PATCH `/api/units/[unitId]/update`
–û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ unit

**Request Body:**
```json
{
  "product_name": "iPhone 15 Pro",
  "partner_name": "Apple Store",
  "price": 99999.99
}
```

**–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:** admin, head, manager, ops

### 3. POST `/api/units/[unitId]/upload-photo`
–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ

**Request:** FormData —Å –ø–æ–ª–µ–º `photo` (File)

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB
- –§–æ—Ä–º–∞—Ç—ã: JPEG, PNG, WEBP

**Response:**
```json
{
  "ok": true,
  "photo": {
    "url": "https://...",
    "filename": "...",
    "uploaded_at": "...",
    "uploaded_by": "...",
    "uploaded_by_name": "..."
  },
  "photos": [...]
}
```

### 4. DELETE `/api/units/[unitId]/upload-photo?filename=...`
–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ

**Query Parameters:**
- `filename` - –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

### 5. GET `/api/units/[unitId]/history`
–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é unit

**Response:**
```json
{
  "ok": true,
  "unit": {...},
  "history": [
    {
      "event_type": "move",
      "created_at": "...",
      "details": {
        "from_cell": "A1",
        "to_cell": "B2",
        "from_status": "receiving",
        "to_status": "storage",
        "actor_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
        "actor_role": "worker"
      }
    },
    {
      "event_type": "shipment",
      "created_at": "...",
      "details": {
        "status": "out",
        "courier_name": "–°–î–≠–ö",
        "shipped_by": "–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞"
      }
    },
    {
      "event_type": "audit",
      "created_at": "...",
      "details": {
        "action": "unit.photo_uploaded",
        "summary": "–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–æ—Ç–æ –¥–ª—è 123456",
        "actor_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
        "actor_role": "manager"
      }
    }
  ]
}
```

## üé® UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ Unit Detail (`/app/units/[unitId]`)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. **–õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞:**
   - üì∑ **–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏** - —Å–µ—Ç–∫–∞ —Ñ–æ—Ç–æ —Å –∫–Ω–æ–ø–∫–æ–π "+" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
   - ‚ÑπÔ∏è **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è (–Ω–∞–∑–≤–∞–Ω–∏–µ, –ø–∞—Ä—Ç–Ω–µ—Ä, —Ü–µ–Ω–∞)

2. **–ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞:**
   - üìú **–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π** - —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π —Å –∏–∫–æ–Ω–∫–∞–º–∏

**–í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ:**
- ‚ú® –ö—Ä–∞—Å–∏–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —Ç–µ–Ω—è–º–∏
- üé® –¶–≤–µ—Ç–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
- üìä –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π grid layout
- üñºÔ∏è –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –ø—Ä–µ–≤—å—é —Ñ–æ—Ç–æ —Å hover —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏

### –¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏

| –ò–∫–æ–Ω–∫–∞ | –¢–∏–ø —Å–æ–±—ã—Ç–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-------------|----------|
| üì¶ | –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ | –î–≤–∏–∂–µ–Ω–∏–µ –º–µ–∂–¥—É —è—á–µ–π–∫–∞–º–∏ |
| üöö | –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ OUT | –û—Ç–≥—Ä—É–∑–∫–∞ –∫—É—Ä—å–µ—Ä—É |
| ‚Ü©Ô∏è | –í–æ–∑–≤—Ä–∞—Ç –∏–∑ OUT | –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å–∫–ª–∞–¥ |
| ‚ú® | –°–æ–∑–¥–∞–Ω–∏–µ | –ü–µ—Ä–≤–∏—á–Ω–∞—è –ø—Ä–∏–µ–º–∫–∞ |
| üì∑ | –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ |
| üóëÔ∏è | –§–æ—Ç–æ —É–¥–∞–ª–µ–Ω–æ | –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ |
| ‚úèÔ∏è | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ |

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–∫–∞–∑–∞ `/app/units/[unitId]`
2. –í —Å–µ–∫—Ü–∏–∏ "–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏" –Ω–∞–∂–º–∏—Ç–µ "+ –î–æ–±–∞–≤–∏—Ç—å"
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª (–¥–æ 5MB, JPEG/PNG/WEBP)
4. –§–æ—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –≤ Supabase Storage
5. –ü–æ—è–≤–∏—Ç—Å—è –≤ —Å–µ—Ç–∫–µ —Å –∏–º–µ–Ω–µ–º –∑–∞–≥—Ä—É–∑–∏–≤—à–µ–≥–æ –∏ –¥–∞—Ç–æ–π

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

1. –í —Å–µ–∫—Ü–∏–∏ "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è" –Ω–∞–∂–º–∏—Ç–µ "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:
   - –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
   - –ü–∞—Ä—Ç–Ω–µ—Ä (–º–µ—Ä—á)
   - –¶–µ–Ω–∞
3. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
4. –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏

–ò—Å—Ç–æ—Ä–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏:
- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –º–µ–∂–¥—É —è—á–µ–π–∫–∞–º–∏
- –û—Ç–ø—Ä–∞–≤–∫–µ –≤ OUT / –≤–æ–∑–≤—Ä–∞—Ç–µ –∏–∑ OUT
- –ó–∞–≥—Ä—É–∑–∫–µ/—É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–æ—Ç–æ
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### RLS –ü–æ–ª–∏—Ç–∏–∫–∏

- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–π warehouse
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ –º–æ–≥—É—Ç –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é: admin, head, manager, ops
- ‚úÖ –£–¥–∞–ª—è—Ç—å —Ñ–æ—Ç–æ –º–æ–≥—É—Ç –≤—Å–µ –∏–∑ —Å–≤–æ–µ–≥–æ warehouse

### –í–∞–ª–∏–¥–∞—Ü–∏—è

**–§–æ—Ç–æ:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB
- –§–æ—Ä–º–∞—Ç—ã: JPEG, PNG, WEBP
- –•—Ä–∞–Ω–µ–Ω–∏–µ: –ø–æ warehouse ‚Üí unit ‚Üí timestamp

**–¶–µ–Ω–∞:**
- –¢–∏–ø: numeric(10, 2)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: >= 0

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é

```bash
# –í Supabase SQL Editor
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ: migrations/supabase_migration_unit_enhancements.sql
```

### 2. –°–æ–∑–¥–∞—Ç—å Storage Bucket

–í Supabase Dashboard:
1. Storage ‚Üí Create bucket ‚Üí `unit-photos`
2. Public: Yes
3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ (—Å–º. –≤—ã—à–µ)

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä

```bash
npm run dev
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π –∑–∞–∫–∞–∑ `/app/units/[unitId]`
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π

## üêõ Troubleshooting

### –§–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** "Failed to upload photo"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å–æ–∑–¥–∞–Ω –ª–∏ bucket `unit-photos`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è Storage
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (< 5MB)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç (JPEG/PNG/WEBP)

### –ò—Å—Ç–æ—Ä–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** "Failed to load history"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –ª–∏ SQL –º–∏–≥—Ä–∞—Ü–∏—è
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `get_unit_history` –≤ Supabase
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

### –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** "Forbidden"

**–†–µ—à–µ–Ω–∏–µ:**
- –¢–æ–ª—å–∫–æ —Ä–æ–ª–∏ admin, head, manager, ops –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ—é —Ä–æ–ª—å –≤ —Ç–∞–±–ª–∏—Ü–µ profiles

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `audit_events`:
- `unit.photo_uploaded` - –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–æ—Ç–æ
- `unit.photo_deleted` - —É–¥–∞–ª–µ–Ω–æ —Ñ–æ—Ç–æ
- `unit.update` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ü—Ä–æ—Å–º–æ—Ç—Ä –≤ –∞—Ä—Ö–∏–≤–µ: `/app/archive`

---

**‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã - —Å—Ç–∞—Ä—ã–µ units –±–µ–∑ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
